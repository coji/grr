# ほたる日記 - UX デザイン仕様書

## コンセプト

**ほたる日記**は、日々の気持ちを記録し、ペルソナ「ほたる」が温かく寄り添うSlack日記アプリです。

### ペルソナ：ほたる

- 夏の夜、静かに光を灯す蛍のような存在
- 長い間、人々が自分の気持ちと向き合う様子を見守ってきた
- 特徴：
  - 急かさず、判断せず、ただ傍らにいる
  - 一人ひとりの心の灯りを尊重する
  - 言葉にならない気持ちも沈黙も受け止める
  - 小さな変化や成長を丁寧に見つめる

## 主要な機能とフロー

### 1. リマインダー送信（自動）

**タイミング:** 毎日 22:00 JST

**対象ユーザー:**

- 過去に日記エントリがあるユーザー
- 当日まだエントリがない場合のみ

**送信方法:**

- ユーザーの最後に使用したチャンネルに投稿
- ユーザーをメンションして、ほたるからの優しいリマインダーメッセージ（2-3文、60文字以内）

**自動アクション:**

- メッセージに気分選択用のリアクションを自動追加:
  - 😄 ほっと安心
  - 😐 ふつうの日
  - 😫 おつかれさま

**初回ユーザー:**

- 過去のエントリがない新規ユーザーはスキップ
- 手動で `@ほたる` メンションして開始する必要がある

---

### 2. 気分の記録（リアクション）

**トリガー:** リマインダーメッセージへのリアクション追加

**気分の選択肢:**

| 絵文字 | ラベル       |
| ------ | ------------ |
| 😄     | ほっと安心   |
| 😐     | ふつうの日   |
| 😫     | おつかれさま |

**動作:**

1. ユーザーがリアクションを付ける
2. 気分が記録される
3. 初回の気分記録時のみ、スレッドで確認メッセージを送信:
   ```
   ほたるが今日のきもち「[ラベル]」をそっと受け取ったよ。いつもおつかれさま。
   ```

**リアクション削除:**

- リアクションを外すと気分の記録も削除される

---

### 3. 詳細の記録（スレッド投稿）

**トリガー:** リマインダーメッセージのスレッドにメッセージ投稿

**動作:**

1. ユーザーがスレッドにメッセージを書く
2. メッセージがスレッド履歴として記録される（複数メッセージは `---` で区切って保存）
3. 35%の確率で、ほたるがメッセージの内容に応じたサポートリアクションを付ける

**記録の仕組み:**

- スレッド内のすべてのメッセージが時系列で保存される
- メンション返信時に、スレッド全体の文脈が利用される

**サポートリアクション候補:**

- sparkles ✨
- heart ❤️
- hugging_face 🤗
- sunny ☀️
- blush 😊
- stars ⭐

---

### 4. メンション返信（インタラクティブ対話）

**トリガー:** `@ほたる` でメンション

#### 4.1. 新規メンション（スレッド外）

**動作:**

1. メンションメッセージに 👀 リアクションが付く（返信を準備中）
2. 新規エントリが作成される
3. メンション内容がスレッドの最初のメッセージとして記録される
4. ほたるがメッセージ内容と気分を踏まえて、温かく返信する（2-3文、120文字以内）
5. ユーザーをメンションしてスレッドに投稿
6. 👀 リアクションが削除され、内容に応じたサポートリアクションに変わる

#### 4.2. スレッド内メンション

**動作:**

1. メンションメッセージに 👀 リアクションが付く（返信を準備中）
2. メンション内容がスレッド履歴に追記される
3. ほたるが以下を踏まえて、文脈に沿った返信をする（2-3文、120文字以内）
   - 今日の気分
   - **前回のエントリ内容**（日々の連続性を理解）
   - **今日のスレッド全体の会話履歴**
   - 今回のメンションメッセージ
4. スレッドで返信
5. 👀 リアクションが削除され、内容に応じたサポートリアクションに変わる

**ほたるの対応:**

- 日々のエントリの流れとスレッド内のすべての会話を記憶
- 「昨日は〜だったけど、今日は〜なんだね」のような連続性のある対話が可能
- ユーザーの具体的な指示や質問（「まとめて」「教えて」「どうだった？」など）には、記録内容を踏まえて応答
- その上で、温かく寄り添う言葉を添える

---

---

## 5. Home Tab - 日記ダッシュボード

**アクセス:** アプリの Home タブを開く

**機能:**

- 今週の気分トレンドグラフ表示
- 最近7日分のエントリ一覧（プレビュー付き）
- ワンクリックで「今日の日記を書く」ボタン
- 設定ボタンからリマインダーのカスタマイズ
- 各エントリに「見る」ボタンで詳細モーダル表示

**UX の特徴:**

- 日記の全体像を一目で把握
- モバイルでも使いやすいUI
- クイックアクセスで記録の障壁を下げる

---

## 6. モーダルフォーム - 構造化エントリ

**トリガー:**

- Home Tab の「今日の日記を書く」ボタン
- リマインダーの「詳細を書く」ボタン
- グローバルショートカット ⚡「日記を書く」

**機能:**

- 日付ピッカーで任意の日付を選択可能
- 気分選択ドロップダウン（😄 ほっと安心 / 😐 ふつうの日 / 😫 おつかれさま）
- マルチライン入力フィールドで詳細を記入
- バリデーションエラー表示

**UX の特徴:**

- スレッドではなくフォームで入力できる
- 過去の日付にも遡って記録可能
- 必須項目の明確化

---

## 7. Slash Command - /diary コマンド群

**利用可能なコマンド:**

- `/diary today` - 今日の日記を表示
- `/diary search キーワード` - 日記を全文検索（最大10件）
- `/diary stats` - 統計表示（総エントリ数、期間、平均気分、気分の内訳）
- `/diary export` - CSV形式でエクスポート（コピペ可能）
- `/diary help` - ヘルプ表示

**UX の特徴:**

- コマンドで素早くアクセス
- 過去の日記を簡単に検索
- データの可視化と分析

---

## 8. Shortcuts - ショートカット機能

### 8.1. メッセージショートカット: `add_to_diary`

**使い方:**

- 任意のメッセージを右クリック → 「日記に追加」
- 今日のエントリに引用として追加
- 新規エントリがない場合は自動作成

### 8.2. グローバルショートカット: `write_diary`

**使い方:**

- ⚡ メニューから「日記を書く」
- どこからでもモーダルを開いて日記作成
- 今日の日付がデフォルトで設定される

**UX の特徴:**

- 思いついた瞬間にすぐ記録
- 他の人のメッセージも日記に保存可能
- コンテキストスイッチを最小化

---

## 9. リマインダーのインタラクティブ機能

**タイミング:** 毎日 22:00 JST

リマインダーメッセージに以下のボタンを追加:

1. **気分選択ボタン（3つ）**:
   - 😄 ほっと安心
   - 😐 ふつうの日
   - 😫 おつかれさま
   - クリック1つで気分を記録

2. **詳細を書く** - モーダルを開く
3. **今日はスキップ** - リマインダーを非表示

**UX の特徴:**

- リアクションではなくボタンで直感的
- ワンクリックで気分記録完了
- 記録後も「詳細を書く」ボタンが残る
- スキップ機能で押し付けがましくない

---

## 10. 週次ダイジェスト

**タイミング:** 毎週土曜日 10:00 JST

**機能:**

- 今週（月〜日）のエントリを自動集計
- AI が振り返りメッセージを生成:
  - 今週の全体的な気分の傾向
  - 印象的だったエピソードや気づき
  - 来週への前向きなメッセージ
- 美しいBlock Kitメッセージで配信
- 今週の記録日数を表示

**UX の特徴:**

- 週末の朝、ゆっくり一週間を振り返り
- AI がポジティブに要約
- モチベーション維持

---

## 11. カスタムリマインダー設定

**アクセス:** Home Tab の「設定」ボタン

**設定可能な項目:**

- **リマインダー有効/無効** - オン/オフ切り替え
- **リマインダー時刻** - 0〜23時の任意の時間を選択
- **週末スキップ** - 土日はリマインダーを送らない

**UX の特徴:**

- 生活リズムに合わせてカスタマイズ
- 休日は通知なし
- 個人の自由度を尊重

---

## 12. 話を聞いてもらう機能

**トリガー:** 日記メッセージに表示される「💬 ほたるに話を聞いてもらう」ボタン（35%の確率で表示）

**動作:**

1. ボタンを押すと、AI がその日のエントリ全体を読む
2. 前回のエントリも参照して文脈を理解
3. 温かいフォローメッセージを返す（2-3文、120文字以内）
4. ボタンはフォローメッセージに置き換わる

**UX の特徴:**

- 押し付けがましくない（ユーザーが求めた時だけ）
- 1日に何度も追記しても大丈夫（ボタンは35%の確率）
- 日記の内容に応じた個別のフォロー

---

## 13. App Unfurl - 日記リンク展開

**使い方:** メッセージ内に `diary://YYYY-MM-DD` 形式のリンクを貼る

**機能:**

- リンクが自動で展開されてプレビュー表示:
  - 日付（YYYY年M月D日）
  - 気分（絵文字 + ラベル）
  - 詳細（最大200文字のプレビュー）
  - フッター「ほたるの日記」+ タイムスタンプ

**UX の特徴:**

- 過去の日記を簡単に参照
- リンクだけで内容が分かる
- チーム内での共有（権限に応じて）

---

## Block Kit によるリッチな表示

すべての自動メッセージを Block Kit で実装:

- **リマインダー**: ボタン付きインタラクティブメッセージ
- **週次ダイジェスト**: ヘッダー + セクション + コンテキスト
- **フォローメッセージ**: セクション形式
- **Home Tab**: カード形式のエントリ一覧

**UX の特徴:**

- 視覚的に美しい
- 情報の階層構造が明確
- アクション可能なボタン

---

## 14. Heartbeat（文脈フォローアップ）

**概要:** ユーザーが日記に未来のイベントを書いた時、翌日以降に「どうだった？」とフォローアップする機能。

**検出対象:**

- 「明日〇〇がある」「来週面接」など、近い将来のイベントへの言及
- 重要そうな出来事（仕事、個人的なイベント、挑戦など）
- 30日以内のイベント

**動作:**

1. ユーザーが日記に未来のイベントを書く
2. AI がイベントを検出し、フォローアップをスケジュール
3. イベントの翌日の 23:00 JST にフォローアップメッセージを送信
4. 「〇〇、どうだった？」と温かく問いかける

**メッセージの例:**

- 「昨日のプレゼン、どうだった？気になってたよ。」
- 「面接、終わったかな。どんな感じだった？」
- 「デート楽しめた？よかったら聞かせてね。」

**UX の特徴:**

- 「覚えていてくれた」という感動を提供
- 押し付けがましくない、さりげない関心
- 話したくなければ無視しても OK
- 週1-2回程度の控えめな頻度

**技術的な詳細:**

- `pending_followups` テーブルでスケジュール管理
- 7日以上経過した未送信のフォローアップは自動で期限切れ
- 重複検出により同じイベントの二重登録を防止

---

## 既知の課題・改善点

1. **初回ユーザーの対応**
   - リマインダーは過去のエントリがあるユーザーのみ
   - 新規ユーザーは手動で `@ほたる` メンションして開始

2. **チャンネル選択**
   - ユーザーが最後に使用したチャンネルに送信
   - チャンネル変更の明示的な方法がない

3. **1日複数エントリ**
   - 複数エントリ可能だが、リマインダーは1日1回のみ
   - 既存エントリがある場合はリマインダーをスキップ

---

## 今後の拡張アイデア

- タグ機能の UI 実装（現在は DB のみ）
- カレンダービューの実装
- 月次/年次レポート
- PDF エクスポート
- グラフ可視化（Chart.js等）
- 他ユーザーとの日記共有機能（オプトイン）
